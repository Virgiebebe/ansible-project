---
- name: Deploy multiple Docker Compose apps
  block:
    - name: Check if {{ item }} folder exists
      stat:
        path: "{{ base_path }}/{{ item }}"
      register: folder_check
      loop: "{{ app_folders }}"
      loop_control:
        label: "{{ item }}"
    
    - name: Debug folder_check to see structure
      debug:
        msg: "folder_check result: {{ folder_check }}"

    - name: Run docker-compose up -d in each app folder
      command: docker-compose up -d
      args:
        chdir: "{{ base_path }}/{{ item }}"
      when: folder_check.results[loop.index0].stat.exists
      loop: "{{ app_folders }}"
      loop_control:
        label: "{{ item }}"

    - name: Warn if any folders were missing
      debug:
        msg: "Folder '{{ item }}' does not exist. Skipping."
      when: not folder_check.results[loop.index0].stat.exists
      loop: "{{ app_folders }}"
      loop_control:
        label: "{{ item }}"
